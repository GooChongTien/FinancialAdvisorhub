# Mira Requirements Matrix (Phase 0)

Implementation Checklist
- [ ] FNA.MANDATORY.FACT_FIND
- [ ] DISCLOSURE.CLIENT_PACK
- [ ] SUITABILITY.BEST_INTEREST
- [ ] COOLING_OFF.NOTICE
- [ ] CHANNEL.MULTI_OPTION.BANK
- [ ] TRAINING.SG.RES5
- [ ] TRAINING.SG.M9
- [ ] TRAINING.MY.PCEIA

Authoritative acceptance criteria distilled from the regulatory and training sources listed in `docs/mira-implementation-plan.md`. Each requirement keeps a stable `REQ_ID`, cites its origin, and expresses executable Given/When/Then checks so we can wire them into Supabase policies, guardrails, and automated tests.

| REQ_ID | Source | Description | Acceptance Criteria (Given/When/Then) |
| --- | --- | --- | --- |
| `FNA.MANDATORY.FACT_FIND` | `docs/Advisor Sale Process Executive Summary.docx:002`, `docs/Insurance Agent Balanced Scorecard Systems in Malaysia and Singapore.docx:030` | Every recommendation must be preceded by a complete, documented fact-find / Financial Needs Analysis (income, dependants, goals, liabilities). | Given `metadata.fact_find?.completed !== true`, When POST `/agent-chat` validates payloads, Then it returns `400 fact_find_required` referencing this REQ.<br>Given a streaming session attempts to emit a proposal before `supabase.fna_records` has all required fields, When the guardrail harness runs, Then it injects a `tool_call` requesting the missing fact-find data and blocks further deltas. |
| `DISCLOSURE.CLIENT_PACK` | `docs/Advisor Sale Process Executive Summary.docx:003`, `docs/Insurance Agent Balanced Scorecard Systems in Malaysia and Singapore.docx:031` | Advisors must deliver an FNA summary + policy illustration / disclosure sheet (IPID, Product Disclosure Sheet, PRIIPs KID) before closing. | Given an advisor finalises a plan package, When `/agent-chat` runs in `mode:"batch"`, Then the response must include `disclosure_bundle` (FNA summary + illustration IDs) or the API rejects the request with REQ_ID reference.<br>Given a streaming session reaches completion, When telemetry logs the `done` event, Then it must persist `disclosure_acknowledged_at`; absence triggers an SSE `error` instructing the advisor to deliver disclosures first. |
| `SUITABILITY.BEST_INTEREST` | `docs/Advisor Sale Process Executive Summary.docx:004` | Recommendations must include a reasonable-basis statement that ties product choice to the client’s needs and risk profile (best-interest duty). | Given a recommendation is generated, When the compliance snapshot is produced, Then it must include `suitability_statement` text that references captured needs, risk score, and selected products.<br>Given POST `/agent-chat` lacks `best_interest.justification_text`, When validation runs, Then it returns HTTP 400 `"best_interest_required"` citing this REQ. |
| `COOLING_OFF.NOTICE` | `docs/Advisor Sale Process Executive Summary.docx:005` | Advisors must explain statutory cooling-off rights (≥14 days) and timestamp the notice whenever a policy is issued. | Given a policy transitions to status `"issued"`, When the release workflow runs, Then it sets `cooling_off_expires_at >= issue_date + 14 days` and enqueues notice communications.<br>Given `/agent-chat` mode `"stream"` tries to emit a final approval while `cooling_off_notice_sent !== true`, When the SSE adapter formats the done event, Then it emits an `error` event instructing the advisor to send the notice first. |
| `CHANNEL.MULTI_OPTION.BANK` | `docs/Advisor Sale Process Executive Summary.docx:006` | Bancassurance flows must surface multiple product options per client to prevent biased recommendations. | Given `advisor_origin === "bancassurance"`, When the recommendation set is assembled, Then at least two option cards with distinct `product_id`s must exist before returning 200.<br>Given a bancassurance record lacks multi-option evidence, When the BSC audit job evaluates it, Then it logs a non-compliance entry and blocks commission release. |
| `TRAINING.SG.RES5` | `docs/Insurance Advisor Training “Espresso Brain” – Singapore & Malaysia.docx:004-005` | Singapore reps must pass CMFAS Module 5 / RES5 before giving advice. | Given `profile.market === "SG"`, When an advisor calls `/agent-chat` (any mode), Then the backend verifies `cmfas.res5_passed_at` exists or responds with 403 `TRAINING.SG.RES5`.<br>Given `res5_valid_until` is in the past, When `/agent-chat` runs `mode:"health"`, Then it returns `{status:"error", missing:["TRAINING.SG.RES5"]}`. |
| `TRAINING.SG.M9` | `docs/Insurance Advisor Training “Espresso Brain” – Singapore & Malaysia.docx:006-008` | SG reps recommending life/ILP products must pass CMFAS M9 + M9A (and HI for medical). | Given `product_type` ∈ {`"life"`, `"ilp"`} for Singapore, When the tool router builds provider calls, Then it confirms `cmfas.m9_passed_at` exists; if not, the API returns 403 referencing this REQ.<br>Given `tool_call.name === "createIlpQuote"` but `cmfas.m9a_passed_at` is null, When the adapter handles the tool call, Then it emits an SSE `error` referencing `TRAINING.SG.M9`. |
| `TRAINING.MY.PCEIA` | `docs/Insurance Advisor Training “Espresso Brain” – Singapore & Malaysia.docx:011-015` | Malaysian life/takaful agents must pass PCEIA (plus CEILLI/TBE for ILP/takaful) before selling. | Given `market === "MY"` and advice scope includes life/takaful, When `/agent-chat` validates the advisor, Then it requires `bnm_pceia_passed === true` or returns 403 `TRAINING.MY.PCEIA`.<br>Given an ILP/takaful recommendation is requested but `ceilli_passed_at` is null, When SSE tries to emit pricing, Then it interrupts with a guardrail event telling Ops to assign a certified rep. |
| `TRAINING.CPD.CORE` | `docs/Insurance Advisor Training “Espresso Brain” – Singapore & Malaysia.docx:010`, `docs/Insurance Advisor Training “Espresso Brain” – Singapore & Malaysia.docx:017` | SG reps need ≥6 “Core” CPD hours/year; MY agents require ≥30 hours (per LIAM/BNM updates). | Given compliance cron runs nightly, When it calculates `cpd_core_hours_last12m`, Then it flags advisors under the minimum with REQ_ID `TRAINING.CPD.CORE` and sets `cpd_overdue=true`.<br>Given an advisor has `cpd_overdue=true`, When they call `/agent-chat`, Then the API responds 403 until `cpd_overdue_cleared_at` is recorded. |
| `BSC.FACT_FIND.SCORE` | `docs/Insurance Agent Balanced Scorecard Systems in Malaysia and Singapore.docx:003-006`, `docs/Insurance Agent Balanced Scorecard Systems in Malaysia and Singapore.docx:030` | Balanced Scorecard ties compensation to fact-find completion and suitability diligence. | Given the BSC nightly job runs, When `fact_find_completion_rate < threshold`, Then it records a penalty, sets `commission_withheld=true`, and links to this REQ.<br>Given `/agent-chat` tries to bypass fact finding, When the SSE guardrail detects `metadata.fact_find_completed !== true`, Then it emits a blocking message requiring completion before continuing. |
| `BSC.DISCLOSURE.SCORE` | `docs/Insurance Agent Balanced Scorecard Systems in Malaysia and Singapore.docx:031-032` | BSC grades demand complete disclosures, rationale, and records at point of sale. | Given an application is submitted, When the BSC audit runs, Then it verifies benefit illustrations + product summaries were delivered; missing docs downgrade the BSC score and block payout.<br>Given a streaming session nears completion while `disclosure.confirmed !== true`, When the stream adapter handles `done`, Then it emits a `tool_call` instructing the advisor to provide disclosures before finishing. |
| `BSC.PERSISTENCY.MONITOR` | `docs/Insurance Agent Balanced Scorecard Systems in Malaysia and Singapore.docx:033-035` | Persistency / post-sale servicing must be monitored; lapses lower BSC and trigger remediation. | Given the 13th-month persistency report is generated, When `persistency_rate` falls below the regulatory floor, Then the job issues remediation tasks and toggles `commission_at_risk=true` tied to this REQ.<br>Given a chat transcript captures a lapse warning, When agent assist logs the event, Then it creates a `pendingAction` to service the policy before any new proposals are approved. |
| `ATOM.PROD.PROTECTION_FIRST` | `docs/# Phase 4 – Expert Brain with examples.txt:51-90`, `docs/# Phase 4 – Expert Brain with examples.txt:783-799` | AI/UX must enforce protection-first sequencing: hospital/CI cover before investment or ILP upsells. | Given a client asks for “investment” while `coverage_gaps.protection === true`, When `createAgentClient` orchestrates adapters, Then the first planner step is `collect_protection_gaps` and ILP tool calls are deferred.<br>Given the KA-PROD-01 replay test runs, When the guardrail sees `recommendation.order[0] !== "protection"`, Then the test fails referencing this REQ. |
| `ATOM.FNA.NEEDS_PRIORITISATION` | `docs/# Phase 4 – Expert Brain with examples.txt:147-151`, `docs/# Phase 4 – Expert Brain with examples.txt:801-816` | Plans must co-create a budgeted roadmap (now/next/later) when clients cite affordability limits. | Given a payload contains `budget_cap_monthly`, When the plan set is produced, Then it includes `now`, `next`, and `later` sections sorted by risk severity with spend totals <= cap.<br>Given streaming detects phrases like “too expensive” / “need to think”, When KA-FNA-02 fires, Then the assistant responds with the documented co-creation questions before pitching new products. |
| `ATOM.ETH.VULNERABLE_CLIENT` | `docs/# Phase 4 – Expert Brain with examples.txt:164-168`, `docs/# Phase 4 – Expert Brain with examples.txt:819-835`, `docs/# Phase 4 – Expert Brain with examples.txt:497-505` | Flag vulnerable clients (older, low literacy, language barriers) and enforce slower explanations + teach-back. | Given `client_age >= 60` OR `language_preference !== default` OR `income_band === "low"`, When a session starts, Then it sets `vulnerable_client=true` and surfaces prompts for simple-language explanations plus teach-back questions.<br>Given `vulnerable_client === true`, When `summary_to_client` is generated, Then it must record confirmation of support-person involvement or explicit comprehension; missing confirmation fails compliance tests referencing this REQ. |
| `ATOM.PSY.TRUST_REPAIR` | `docs/# Phase 4 – Expert Brain with examples.txt:155-170`, `docs/# Phase 4 – Expert Brain with examples.txt:600-607` | Conversations with clients burned by prior mis-selling must acknowledge emotion, offer neutral reviews, and delay new product pushes until trust is rebuilt. | Given conversation sentiment contains “don’t trust” / “burnt before”, When the assistant composes a reply, Then the first delta acknowledges the emotion and offers a neutral policy review before any sales pitch.<br>Given the Domain 4 scenario #4 replay runs, When evaluation detects `trust_repair_flow.completed !== true`, Then it enforces a `no_new_product` recommendation placeholder until the flow is completed. |

> Store these canonical rows in Supabase (`mira_requirement_matrix`) so we can trace every test, telemetry event, and UI guardrail back to a `REQ_ID`. This Markdown stays in git as the human-readable export required by Phase 0.
